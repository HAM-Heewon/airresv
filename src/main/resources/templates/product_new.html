<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>항공편 및 번호 등록</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" type="text/css" href="./css/head_menu.css">
<link rel="stylesheet" type="text/css" href="./css/product_new.css">
</head>
<body>
<div class="container">
    <div th:replace="admin_header :: header"></div>
    
    <div th:replace="admin_menu :: menu"></div>
    
    <!-- 메인 콘텐츠 -->
    <div class="content">
        <h2 class="section-title">항공편 및 번호 등록 페이지</h2>
        
        <!-- 등록 폼 -->
        <div class="registration-form">
            <form id="airlineForm" onsubmit="return submitForm(event)">
                
                <!-- 항공코드 -->
                <div class="form-row">
                    <label class="form-label">공항코드</label>
                    <div class="form-input">
                        <select class="form-select" name="airlineCode" id="airlineCode">
                            <option value="">공항코드를 선택해세요</option>
                            <option value="GMP">GMP - 김포국제공항</option>
                            <option value="ICN">ICN - 인천국제공항</option>
                            <option value="PUS">PUS - 김해국제공항</option>
                            <option value="CJU">CJU - 제주국제공항</option>
                        </select>
                    </div>
                </div>
                
                <!-- 항공사명 -->
                <div class="form-row">
                    <label class="form-label">항공사명</label>
                    <div class="form-input">
                        <select class="form-select" name="airlineName" id="airlineName">
                            <option value="">항공사명을 선택해세요</option>
                            <option value="대한항공">대한항공</option>
                            <option value="아시아나항공">아시아나항공</option>
                            <option value="제주항공">제주항공</option>
                            <option value="진에어">진에어</option>
                            <option value="티웨이항공">티웨이항공</option>
                        </select>
                    </div>
                </div>
                
                <!-- 항공편코드 -->
                <div class="form-row">
                    <label class="form-label">항공코드</label>
                    <div class="form-input">
                        <select class="form-select" name="flightCode" id="flightCode">
                            <option value="">항공코드를 선택해세요</option>
                            <option value="KE">KE - 대한항공</option>
                            <option value="OZ">OZ - 아시아나항공</option>
                            <option value="7C">7C - 제주항공</option>
                            <option value="LJ">LJ - 진에어</option>
                            <option value="TW">TW - 티웨이항공</option>
                        </select>
                        <button type="button" class="btn-code" onclick="openCodeManager()">항공 코드 등록</button>
                        <span class="code-note">※ 항공코드는 절대 중복되지 않도록 합니다.</span>
                    </div>
                </div>
                
                <!-- 항공편명 -->
                <div class="form-row">
                    <label class="form-label">항공편명</label>
                    <div class="form-input">
                        <input type="text" class="form-text" name="flightName" id="flightName" placeholder="항공편명을 입력하세요">
                    </div>
                </div>
                
                <!-- 출발지 -->
                <div class="form-row">
                    <label class="form-label">출발지</label>
                    <div class="form-input">
                        <input type="text" class="form-text-small" name="departure" id="departure">
                        <span class="input-note">※ 출발지와 도착지가 같을 수 없습니다.</span>
                    </div>
                </div>
                
                <!-- 도착지 -->
                <div class="form-row">
                    <label class="form-label">도착지</label>
                    <div class="form-input">
                        <input type="text" class="form-text-small" name="arrival" id="arrival">
                        <span class="input-note">※ 출발지와 도착지가 같을 수 없습니다.</span>
                    </div>
                </div>
                
                <!-- 좌석 형태 및 가격 (동적 추가/제거) -->
                <div class="form-row">
                    <label class="form-label">좌석 형태 및 가격</label>
                    <div class="form-input" style="flex-direction: column; align-items: flex-start; gap: 8px;">
                        <div id="seatTypeContainer" style="width: 100%;">
                            <!-- 좌석 형태와 가격 입력 필드가 동적으로 추가될 영역 -->
                            <div class="seat-type-item">
                                <input type="text" class="form-text-small seat-type-name" placeholder="좌석 형태명 (예: 일반석, 프레스티지석, 일등석, 비지니스석)">
                                <input type="number" class="form-text-number seat-type-price" placeholder="가격" min="0" step="100">
                                <span class="unit">원</span>
                                <button type="button" class="btn-remove-seat" onclick="removeSeatTypeField(this)">삭제</button>
                            </div>
                        </div>
                        <button type="button" class="btn-add-seat-type" onclick="addSeatTypeField()">+ 좌석 형태 추가</button>
                    </div>
                </div>
                
                <!-- 좌석수 -->
                <div class="form-row">
                    <label class="form-label">좌석수</label>
                    <div class="form-input">
                        <input type="number" class="form-text-number" name="seatCount" id="seatCount" value="0" min="0">
                        <span class="unit">EA</span>
                        <span class="input-note">※ 숫자만 입력하세요, 재고가 0일 경우 soldout이 됩니다.</span>
                    </div>
                </div>
                
                <!-- 비행시간 -->
                <div class="form-row">
                    <div class="form-input">
                       <label class="form-label">비행시간</label>
                        <div class="radio-group">
                            <label class="radio-item">
                                <input type="radio" name="flightTime" value="운행가능" checked>
                                <span>운행가능</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="flightTime" value="운행중단">
                                <span>운행종료</span>
                            </label>
                        </div>
                        <span class="input-note">※ 운행중료로 선택한 경우 고객은 해당 항공을 이용하지 못합니다.</span>
                    </div>
                </div>
                
            </form>
        </div>
        
        <!-- 버튼 그룹 -->
        <div class="button-group">
            <button type="button" class="btn btn-list" onclick="location.href='/product_list'">항공편 리스트</button>
            <button type="button" class="btn btn-register" onclick="submitForm(event)">신규항공편 등록</button>
        </div>
    </div>
</div>
<div th:replace="admin_footer :: footer"></div>

<script>
// 메뉴 활성화 스크립트
document.addEventListener('DOMContentLoaded', function() {
    const currentPath = window.location.pathname;
    const menuItems = document.querySelectorAll('.menu-item');
    
    // 모든 메뉴에서 active 클래스 제거
    menuItems.forEach(item => {
        item.classList.remove('active');
    });
    
    // 항공편 관리 메뉴 활성화
    menuItems.forEach(item => {
        const href = item.getAttribute('href');
        
        if (href === '/product_new' || href.includes('product')) {
            item.classList.add('active');
        }
    });
    
 // 페이지 로드 시 최소 하나의 좌석 형태 입력 필드 확인
    const seatTypeContainer = document.getElementById('seatTypeContainer');
    if (seatTypeContainer.children.length === 0) {
        addSeatTypeField(); // 없으면 하나 추가
    }
});

// 항공코드 관리 페이지 열기
function openCodeManager() {
    // 실제 구현시 항공코드 관리 페이지로 이동
    location.href = '/air_newcode';
}

//좌석 형태 및 가격 필드 추가 함수
function addSeatTypeField() {
    const container = document.getElementById('seatTypeContainer');
    const newSeatTypeItem = document.createElement('div');
    newSeatTypeItem.className = 'form-input seat-type-item'; // .form-input 클래스도 추가하여 스타일 일관성 유지

    newSeatTypeItem.innerHTML = `
        <input type="text" class="form-text-small seat-type-name" placeholder="좌석 형태명 (예: 일반석, 프레스티지석, 일등석, 비지니스석)">
        <input type="number" class="form-text-number seat-type-price" placeholder="가격" min="0" step="100">
        <span class="unit">원</span>
        <button type="button" class="btn-remove-seat" onclick="removeSeatTypeField(this)">삭제</button>
    `;
    container.appendChild(newSeatTypeItem);
}

// 좌석 형태 및 가격 필드 제거 함수
function removeSeatTypeField(button) {
    const itemToRemove = button.parentNode;
    const container = document.getElementById('seatTypeContainer');
    
    // 마지막 남은 필드는 삭제 못하게 (최소 하나는 있어야 함)
    if (container.children.length > 1) {
        container.removeChild(itemToRemove);
    } else {
        alert('최소 하나의 좌석 형태는 등록해야 합니다.');
    }
}

// 항공사명 변경시 항공편코드 자동 설정
document.getElementById('airlineName').addEventListener('change', function() {
    const airlineName = this.value;
    const flightCodeSelect = document.getElementById('flightCode');
    
    // 항공편코드 옵션 초기화
    flightCodeSelect.value = '';
    
    // 항공사명에 따른 항공편코드 자동 선택
    switch(airlineName) {
        case '대한항공':
            flightCodeSelect.value = 'KE';
            break;
        case '아시아나항공':
            flightCodeSelect.value = 'OZ';
            break;
        case '제주항공':
            flightCodeSelect.value = '7C';
            break;
        case '진에어':
            flightCodeSelect.value = 'LJ';
            break;
        case '티웨이항공':
            flightCodeSelect.value = 'TW';
            break;
    }
});

// 숫자 입력 필드에서 음수 방지
document.getElementById('seatCount').addEventListener('input', function() {
    if (this.value < 0) {
        this.value = 0;
    }
});
</script>
</body>
</html>